schedules:
  - cron: "0 0 * * *"
    displayName: Daily midnight build
    branches:
      include:
      - master
pr:
  - master

pool:
  vmImage: 'ubuntu-16.04'

container:
  image: vowpalwabbit/ubuntu1604-build:0.3.0
  endpoint: DockerHub

strategy:
  matrix:
    Debug:
      BUILD_CONFIGURATION: 'Debug'
    Release:
      BUILD_CONFIGURATION: 'Release'
  maxParallel: 2

steps:
- bash: sudo apt-get install -y valgrind
  displayName: Install Valgrind
- bash: ./.scripts/linux/build-minimal.sh $(BUILD_CONFIGURATION)
  displayName: Build C++ VW binary
- bash: ./.scripts/linux/test-valgrind.sh
  displayName: Run test suite with Valgrind
